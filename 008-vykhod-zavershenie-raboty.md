### 8\. Выход (завершение работы)

Существуют различные способы остановки Node.js-приложения. 

При запуске программы посредством терминала, вы можете закрыть его с помощью ctrl-C, однако давайте обсудим программные способы. 

Начнем с самого радикального, и скажем, почему его не следует использовать. 

Основной (глобальный, модуль ядра) модуль process содержит удобный метод, позволяющий программно выйти из Node.js-приложения: process.exit(). 

Когда Node.js достигает этой строки кода, процесс выполнения программы немедленно завершается. 

Это означает, что все выполняющиеся функции обратного вызова, отправленные (незавершенные) запросы, открытый доступ к файловой системе, процессы записи в stdout или stderr - все они будут жестко прерваны. 

Если это для вас является приемлемым, вы можете передать методу exit() целое число - сигнал к завершению выполнения кода:
`
process.exit(1)
`

По умолчанию код выхода - 0, указывающий на успешное завершение. Разные коды выхода имеют разное значение, вы можете использовать их для взаимодействия одних программ с другими. 

Подробнее о кодах выхода можно почитать [здесь][anchor0].

Также вы можете присвоить соответствующее значение свойству exitCode:
`
process.exitCode = 1
`

и после завершения программы, Node.js вернет этот код. 

Выполнение программы завершится мягко, когда все процессы будут выполнены. 

В Node.js мы часто запускаем сервер:

	const express = require('express')
	const app = express()

	app.get('/', (req, res) => {
	    res.send('Hi!')
	})

	app.listen(3000, () => console.log('Server ready'))

Эта программа никогда не завершится. Если вы вызовете process.exit(), все ожидающие или выполняющиеся запросы будут прерваны. Это не круто. 

В данном случае необходимо отправить команду-сигнал SIGTERM и обработать ее с помощью обработчика процессорных сигналов (process подключать не нужно, он доступен по умолчанию):

	const express = require('express')

	const app = express()

	app.get('/', (req, res) => {
	    res.send('Hi!')
	})

	const server = app.listen(3000, () => console.log('Server ready'))

	process.on('SIGTERM', () => {
	    server.close(() => {
	        console.log('Process terminated')
	    })
	})

Что такое сигналы? Сигналы - это система коммуникации POSIX: отправка процессу уведомления о произошедшем событии. 

SIGKILL - сигнал о немедленном завершении процесса, аналогичный process.exit(). 

SIGTERM - сигнал о мягком завершении процесса. Этот сигнал может быть отправлен системой управления процессами, такой как upstart, supervisord и др. 

Вы можете отправить данный сигнал внутри программы через другую функцию:
`
process.kill(process.id, 'SIGTERM')
`

Или из другой Node.js-программы или любого другого приложения, запущенного в системе, при условии, что им известен PID процесса, который вы хотите завершить. 

### Как читать переменные среды в Node.js?

Основной модуль Node.js process имеет свойство env, содержащее все переменные среды, установленные при запуске процесса. 

Вот пример получения доступа к переменной среды NODE\_ENV, установленной в значение development по умолчанию:
`
process.env.NODE_ENV // development
`

Установка значения в production перед выполнением скрипта сообщит Node.js о том, что перед ним среда для продакшна. 

Аналогичным способом вы можете получить доступ к любой переменной среды. 

[anchor0]: https://nodejs.org/api/process.html#process_exit_codes

